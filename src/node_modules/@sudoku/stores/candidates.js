import { writable } from 'svelte/store';

function createCandidates() {
	const candidates = writable({});

	return {
		subscribe: candidates.subscribe,

		add(pos, candidate) {
			candidates.update($candidates => {
				const key = pos.x + ',' + pos.y;
				const newCandidates = { ...$candidates };
				if (!newCandidates.hasOwnProperty(key)) {
					newCandidates[key] = [candidate];
				} else if (newCandidates[key].includes(candidate)) {
					newCandidates[key] = newCandidates[key].filter(n => n !== candidate);
				} else {
					newCandidates[key] = [...newCandidates[key], candidate];
				}
				return newCandidates;
			});
		},

		clear(pos) {
			candidates.update($candidates => {
				const key = pos.x + ',' + pos.y;
				const newCandidates = { ...$candidates };
				delete newCandidates[key];
				return newCandidates;
			});
		}
	}
}

export const candidates = createCandidates();